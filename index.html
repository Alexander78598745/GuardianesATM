<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Guardianes Atleti</title>
    
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#111a36">
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <link rel="stylesheet" href="style.css">
</head>
<body data-theme="dark">

    <div id="toast-container" class="toast-container"></div>

    <div id="modal-login" class="modal-overlay" style="display:none;">
        <div class="modal-box animate-pop">
            <h3 style="color:var(--atm-red); margin-bottom:15px;">ACCESO</h3>
            <div class="password-wrapper">
                <input type="password" id="modal-pass" placeholder="****" class="pass-input">
                <i class="fas fa-eye toggle-password" onclick="togglePasswordVisibility()"></i>
            </div>
            <div class="row">
                <button class="btn-secondary" onclick="cerrarModal()">CANCELAR</button>
                <button class="btn-main" onclick="confirmarLogin()" style="margin-top:0;">ENTRAR</button>
            </div>
        </div>
    </div>

    <header>
        <div class="header-content">
            <img src="logo.png" class="escudo-img" alt="ATM" onerror="this.style.display='none'"> 
            <div class="header-text">
                <h1>Guardianes <span class="highlight">Atleti</span></h1>
                <p>Academia de Porteros</p>
            </div>
        </div>
        <div style="display:flex; gap:15px; align-items:center;">
            <button id="btn-theme" class="btn-logout-clean" onclick="toggleTheme()"><i class="fas fa-sun"></i></button>
            <button id="btn-logout" class="btn-logout-clean" onclick="logout()" style="display:none;"><i class="fas fa-power-off"></i></button>
        </div>
    </header>

    <main>
        <section id="view-home" class="animate-fade">
            <div class="login-container-width" style="text-align:center; margin-top:40px;">
                <h2 style="font-weight:800; text-transform:uppercase; color:var(--text-main);">Selecciona Perfil</h2>
                <div class="login-grid">
                    <div class="login-card" onclick="abrirLogin('portero')"><div class="icon-circle"><i class="fas fa-mitten"></i></div><h3>PORTERO</h3></div>
                    <div class="login-card" onclick="abrirLogin('edp')"><div class="icon-circle"><i class="fas fa-stopwatch"></i></div><h3>EDP</h3></div>
                    <div class="login-card" onclick="abrirLogin('admin')"><div class="icon-circle"><i class="fas fa-shield-alt"></i></div><h3>ADMIN</h3></div>
                </div>
            </div>
        </section>

        <section id="view-admin" style="display:none;">
            <div class="modern-card">
                <div class="section-header"><h2>Alta Porteros</h2></div>
                
                <div class="profile-upload-container" onclick="document.getElementById('fileInput').click()">
                    <img id="fotoPreview" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNTAiIGhlaWdodD0iMTUwIiB2aWV3Qm94PSIwIDAgMTUwIDE1MCI+PHJlY3Qgd2lkdGg9IjE1MCIgaGVpZ2h0PSIxNTAiIGZpbGw9IiMzMzMiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiIGZvbnQtZmFtaWx5PSJQXSwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIyMCI+Rk9UTzwvdGV4dD48L3N2Zz4=" style="width:100%; height:100%; object-fit:cover; border-radius:50%; border:3px solid var(--atm-red);">
                    <div class="upload-badge"><i class="fas fa-camera"></i></div>
                </div>
                <input type="file" id="fileInput" accept="image/*" onchange="procesarImagenSegura(event)" style="display:none;">
                <input type="hidden" id="reg-id">
                
                <div class="form-grid">
                    <div class="form-full"><label class="input-label">Nombre</label><input type="text" id="reg-nombre" placeholder="Nombre Completo"></div>
                    <div><label class="input-label">Equipo</label><input type="text" id="reg-equipo" placeholder="Ej: Alevín A"></div>
                    <div><label class="input-label">Año</label><input type="number" id="reg-ano" placeholder="2012"></div>
                    <div>
                        <label class="input-label">Sede</label>
                        <select id="reg-sede">
                            <option value="CD Alcalá">CD Alcalá</option>
                            <option value="Cotorruelo">Cotorruelo</option>
                        </select>
                    </div>
                    <div><label class="input-label">EDP</label><select id="reg-entrenador-select"><option value="">Cargando...</option></select></div>
                    <div class="form-full"><label class="input-label">Clave</label><input type="text" id="reg-clave" placeholder="Contraseña Acceso"></div>
                </div>
                <div class="row" style="margin-top:15px;">
                    <button class="btn-secondary" onclick="limpiarFormAdmin()">LIMPIAR</button>
                    <button class="btn-main" onclick="guardarPortero()" style="margin-top:0;">GUARDAR</button>
                </div>
            </div>

            <div class="modern-card" style="border-left: 4px solid #f1c40f;">
                <h3>Alta Entrenador (EDP)</h3>
                <div class="form-grid" style="margin-top:10px;">
                    <input type="text" id="edp-nombre" placeholder="Nombre EDP">
                    <input type="text" id="edp-clave" placeholder="Clave Acceso">
                </div>
                <button class="btn-main" onclick="crearEDP()" style="margin-top:5px; background:var(--text-sec); color:black;">Crear EDP</button>
            </div>

            <div class="section-divider">PORTEROS</div>
            <div id="admin-lista-porteros"></div>
            <div class="section-divider">EDPs</div>
            <div id="admin-lista-edps"></div>
        </section>

        <section id="view-edp" style="display:none;">
            <div class="section-header"><h2>Panel Técnico</h2></div>
            <div id="edp-lista-porteros"></div>
        </section>

        <section id="view-portero" style="display:none;">
            <div class="fifa-card-container">
                <div class="fifa-card-simple">
                    <div class="fifa-simple-top">
                        <div style="flex:1;">
                            <div class="fifa-rating-simple" id="fifa-rating">60</div>
                            <div class="fifa-pos-simple">POR</div>
                        </div>
                        <img src="logo.png" style="width:50px; opacity:0.9;" onerror="this.style.display='none'">
                    </div>
                    <div class="fifa-photo-frame">
                        <img id="card-foto" class="fifa-player-img-simple" src="" onerror="this.style.display='none'">
                    </div>
                    <div class="fifa-simple-bottom">
                        <div class="fifa-name-simple" id="dash-card-nombre">NOMBRE</div>
                        <div class="fifa-stats-grid">
                            <div><span id="stat-tec">60</span> TEC</div><div><span id="stat-fis">60</span> JUE</div>
                            <div><span id="stat-men">60</span> ACT</div><div><span id="stat-tac">60</span> RET</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="feedback-bubble" style="margin-top:20px;">
                <div class="feedback-title"><i class="fas fa-comment-dots"></i> Mensaje del Míster:</div>
                <div id="dash-feedback-content">...</div>
            </div>

            <div class="modern-card" style="margin-top:20px;">
                 <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h3 id="level-title" style="color:var(--lvl-1); font-size:1rem;">Nivel 1</h3>
                    <span class="badge" id="dash-puntos-badge">0 PTS</span>
                </div>
                <div class="progress-track">
                    <div class="progress-fill" id="progress-fill" style="width:0%"></div>
                </div>
                <div class="level-grid-system">
                    <div class="lvl-col"><div class="lvl-circle">1</div></div>
                    <div class="lvl-col"><div class="lvl-circle">2</div></div>
                    <div class="lvl-col"><div class="lvl-circle">3</div></div>
                    <div class="lvl-col"><div class="lvl-circle">4</div></div>
                    <div class="lvl-col"><div class="lvl-circle"><i class="fas fa-star"></i></div></div>
                </div>
            </div>

            <div class="modern-card">
                <h3><i class="fas fa-trophy" style="color:#FFD700;"></i> Muro de Trofeos</h3>
                <div id="insignias-container" class="insignias-grid"></div>
            </div>
            
            <div class="modern-card">
                <h3>Análisis ADN</h3>
                <div style="position: relative; height:250px; width:100%;">
                    <canvas id="adnChart"></canvas>
                </div>
            </div>
        </section>

        <section id="view-ranking" style="display:none;">
            <div class="modern-card" style="text-align:center;">
                <h2 style="margin-bottom:15px; color:var(--text-main);">CLASIFICACIÓN</h2>
                <div class="ios-segmented-control">
                    <button class="segment-btn active" id="rank-global" onclick="toggleRanking('global')">Global</button>
                    <button class="segment-btn" id="rank-alcala" onclick="toggleRanking('CD Alcalá')">Alcalá</button>
                    <button class="segment-btn" id="rank-cotorruelo" onclick="toggleRanking('Cotorruelo')">Cotorruelo</button>
                </div>
            </div>
            <div id="smart-rankings" class="smart-rank-grid"></div>
            <div class="section-divider section-divider-center">TABLA</div>
            <div id="ranking-list-container"></div>
        </section>
    </main>

    <nav class="floating-nav" id="nav-portero" style="display:none;">
        <button onclick="navPortero('home')" class="active" id="nav-btn-home"><i class="fas fa-user"></i></button>
        <button onclick="navPortero('ranking')" id="nav-btn-rank"><i class="fas fa-chart-bar"></i></button>
    </nav>

    <script type="module" src="app.js"></script>
</body>
</html>